<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Legends | ComplexHeatmap Complete Reference</title>
<meta name="author" content="Zuguang Gu">
<meta name="description" content="The heatmaps and simple annotations automatically generate legends which are put one the right side of the heatmap. By default there is no legend for complex annotations, but they can be...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="Chapter 5 Legends | ComplexHeatmap Complete Reference">
<meta property="og:type" content="book">
<meta property="og:url" content="https://jokergoo.github.io/ComplexHeatmap-reference/book/legends.html">
<meta property="og:image" content="https://jokergoo.github.io/ComplexHeatmap-reference/book/complexheatmap-cover.jpg">
<meta property="og:description" content="The heatmaps and simple annotations automatically generate legends which are put one the right side of the heatmap. By default there is no legend for complex annotations, but they can be...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Legends | ComplexHeatmap Complete Reference">
<meta name="twitter:description" content="The heatmaps and simple annotations automatically generate legends which are put one the right side of the heatmap. By default there is no legend for complex annotations, but they can be...">
<meta name="twitter:image" content="https://jokergoo.github.io/ComplexHeatmap-reference/book/complexheatmap-cover.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><style>
    #content {
    	font-size: 0.95rem;
    }
    </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">ComplexHeatmap Complete Reference</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="a-single-heatmap.html"><span class="header-section-number">2</span> A Single Heatmap</a></li>
<li><a class="" href="heatmap-annotations.html"><span class="header-section-number">3</span> Heatmap Annotations</a></li>
<li><a class="" href="a-list-of-heatmaps.html"><span class="header-section-number">4</span> A List of Heatmaps</a></li>
<li><a class="active" href="legends.html"><span class="header-section-number">5</span> Legends</a></li>
<li><a class="" href="heatmap-decoration.html"><span class="header-section-number">6</span> Heatmap Decoration</a></li>
<li><a class="" href="oncoprint.html"><span class="header-section-number">7</span> OncoPrint</a></li>
<li><a class="" href="upset-plot.html"><span class="header-section-number">8</span> UpSet plot</a></li>
<li><a class="" href="interactive.html"><span class="header-section-number">9</span> Interactive ComplexHeatmap</a></li>
<li><a class="" href="integrate-with-other-packages.html"><span class="header-section-number">10</span> Integrate with other packages</a></li>
<li><a class="" href="other-high-level-plots.html"><span class="header-section-number">11</span> Other High-level Plots</a></li>
<li><a class="" href="three-d-heatmap.html"><span class="header-section-number">12</span> Three-dimensional ComplexHeatmap</a></li>
<li><a class="" href="genome-level-heatmap.html"><span class="header-section-number">13</span> Genome-level heatmap</a></li>
<li><a class="" href="more-examples.html"><span class="header-section-number">14</span> More Examples</a></li>
<li><a class="" href="other-tricks.html"><span class="header-section-number">15</span> Other Tricks</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jokergoo/ComplexHeatmap">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="legends" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Legends<a class="anchor" aria-label="anchor" href="#legends"><i class="fas fa-link"></i></a>
</h1>
<p>The heatmaps and simple annotations automatically generate legends which are
put one the right side of the heatmap. By default there is no legend for
complex annotations, but they can be constructed and added manually (Section
<a href="legends.html#add-customized-legends">5.5</a>). All legends are internally constructed by
<code>Legend()</code> constructor. In later sections, we first introduce the settings for
continuous legends and discrete legends, then we will discuss how to configure
the legends associated with the heatmaps and annotations, and how to add new
legends to the plot.</p>
<p>All the legends (no matter a single legend or a pack of legends) all belong to
the <code>Legends</code> class. The class only has one slot <code>grob</code> which is the real
<code><a href="https://rdrr.io/r/grid/grid.grob.html">grid::grob</a></code> object or the <code><a href="https://rdrr.io/r/grid/grid.grob.html">grid::gTree</a></code> object that records how to draw the
graphics. The wrapping of the <code>Legends</code> class and the methods designed for the
class make legends as single objects and can be drawn like points with
specifying the positions on the viewport.</p>
<p>The legends for heatmaps and annotations can be controlled by
<code>heatmap_legend_param</code> argument in <code>Heatmap()</code>, or <code>annotation_legend_param</code>
argument in <code>HeatmapAnnotation()</code>. <strong>Most of the parameters in <code>Legend()</code>
function can be directly set in the two arguments with the same parameter
name.</strong> The details of setting heatmap legends and annotation legends
parameters are introduced in Section <a href="legends.html#heatmap-and-annotation-legends">5.4</a>.</p>
<div id="continuous-legends" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Continuous legends<a class="anchor" aria-label="anchor" href="#continuous-legends"><i class="fas fa-link"></i></a>
</h2>
<p>Since most of heatmaps contain continuous values, we first introduce the
settings for the continuous legend.</p>
<p>Continuous legend needs a color mapping function which should be generated by
<code><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html">circlize::colorRamp2()</a></code>. In the heatmap legends and annotation legends that
are automatically generated, the color mapping functions are passed by the
<code>col</code> argument from <code>Heatmap()</code> or <code>HeatmapAnnotation()</code> function, while if
you construct a self-defined legend, you need to provide the color mapping
function.</p>
<p>The break values provided in the color mapping function (e.g. <code>c(0, 0.5, 1)</code>
in following example) will not exactly be the same as the break values in the
legends). The finally break values presented in the legend are internally
adjusted to make the numbers of labels close to 5 or 6.</p>
<p>First we show the default style of a vertical continuous legend:</p>
<div class="sourceCode" id="cb426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/circlize">circlize</a></span><span class="op">)</span>
<span class="va">col_fun</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html">colorRamp2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"white"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span>
<span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-3-1.png" width="52.5490813648294" style="display: block; margin: auto;"></div>
<p><code>lgd</code> is a <code>Legends</code> class object. The size of the legend can be obtained by
<code>ComplexHeatmap:::width()</code> and <code>ComplexHeatmap:::height()</code> function.</p>
<div class="sourceCode" id="cb427"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ComplexHeatmap</span><span class="fu">:::</span><span class="fu">width</span><span class="op">(</span><span class="va">lgd</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 9.90361111111111mm</code></pre>
<div class="sourceCode" id="cb429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ComplexHeatmap</span><span class="fu">:::</span><span class="fu">height</span><span class="op">(</span><span class="va">lgd</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 30.2744052165491mm</code></pre>
<p>The legend is actually a packed graphic object composed of rectangles, lines
and texts. It can be added to the plot by <code>draw()</code> function. In
<strong>ComplexHeatmap</strong> pacakge, you don’t need to use <code>draw()</code> directly on legend
objects, but it might be useful if you use the legend objects in other places.</p>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pushViewport</span><span class="op">(</span><span class="fu">viewport</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span>, height <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span>
<span class="fu">grid.rect</span><span class="op">(</span><span class="op">)</span>  <span class="co"># border</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">lgd</span>, x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span>, just <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">lgd</span>, x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"npc"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"npc"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">lgd</span>, x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span>, just <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"top"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">popViewport</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></div>
<p>If you only want to configure the legends generated by heatmaps or
annotations, you don’t need to construct the <code>Legends</code> object by your own.
<strong>The parameters introduced later can be directly used to customize the
legends by <code>heatmap_legend_param</code> argument in <code>Heatmap()</code> and
<code>annotation_legend_param</code> argument in <code>HeatmapAnnotation()</code></strong> (introduced in
Section
<a href="legends.html#heatmap-and-annotation-legends">5.4</a>). It is still nice to see how these parameters change the
styles of the legend in following examples. Following is a simple example
showing how to configure legends in the heatmap and heatmap annotation.</p>
<div class="sourceCode" id="cb432"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">Heatmap</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>, 
    heatmap_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        title <span class="op">=</span> <span class="st">"rnorm"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, 
        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"neg_two"</span>, <span class="st">"zero"</span>, <span class="st">"pos_two"</span><span class="op">)</span>
    <span class="op">)</span>,
    top_annotation <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>
        foo <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,
        annotation_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>foo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"foo_top_anno"</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-6-1.png" width="499.2" style="display: block; margin: auto;"></div>
<p>In following examples, we only show how to construct the legend object, while
not show the code which draws the legends. Only remember you can use <code>draw()</code>
function on the <code>Legends</code> object to draw the single legend on the plot.</p>
<p>For continuous legend, you can manually adjust the break values in the legend
by setting <code>at</code>. Note the height is automatically adjusted.</p>
<div class="sourceCode" id="cb433"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-8-1.png" width="59.9624146981627" style="display: block; margin: auto;"></div>
<p>The labels corresponding to the break values are set by <code>labels</code>.</p>
<div class="sourceCode" id="cb434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, 
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"median"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-10-1.png" width="77.7357480314961" style="display: block; margin: auto;"></div>
<p>The height of the vertical continous legend is set by <code>legend_height</code>.
<code>legend_height</code> can only be set for the veritcal continous legend and the
value is the height of the legend body (excluding the legend title).</p>
<div class="sourceCode" id="cb435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, legend_height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">6</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-12-1.png" width="52.5490813648294" style="display: block; margin: auto;"></div>
<p>If it is a vertical legend, <code>grid_width</code> controls the widths of the legend
body. <code>grid_width</code> is originally designed for the discrete legends where the
each level in the legend is a grid, but here we use the same name for the
parameter that controls the width of the legend.</p>
<div class="sourceCode" id="cb436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, grid_width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-14-1.png" width="75.2262467191601" style="display: block; margin: auto;"></div>
<p>The graphic parameters for the labels are controlled by <code>labels_gp</code>.</p>
<div class="sourceCode" id="cb437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, labels_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span>, font <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-16-1.png" width="52.5490813648294" style="display: block; margin: auto;"></div>
<p>The border of the legend as well as the ticks for the break values are
controlled by <code>border</code>. The value of <code>border</code> can be logical or a string of
color.</p>
<div class="sourceCode" id="cb438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, border <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-18-1.png" width="52.5490813648294" style="display: block; margin: auto;"></div>
<p><code>title_position</code> controls the position of titles. For vertical legends, the
value should be one of <code>topleft</code>, <code>topcenter</code>, <code>lefttop-rot</code> and
<code>leftcenter-rot</code>. Following two plots show the effect of <code>lefttop-rot</code> title
and <code>leftcenter-rot</code> title.</p>
<div class="sourceCode" id="cb439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foooooooo"</span>, title_position <span class="op">=</span> <span class="st">"lefttop-rot"</span>,
    legend_height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-20-1.png" width="69.681469816273" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foooooooo"</span>, title_position <span class="op">=</span> <span class="st">"leftcenter-rot"</span>,
    legend_height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-22-1.png" width="69.681469816273" style="display: block; margin: auto;"></div>
<p>Legend titles and labels can be set as mathematical formulas.</p>
<div class="sourceCode" id="cb441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">hat</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op">==</span> <span class="op">(</span><span class="va">X</span><span class="op">^</span><span class="va">t</span> <span class="op">*</span> <span class="va">X</span><span class="op">)</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">1</span><span class="op">}</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="va">t</span> <span class="op">*</span> <span class="va">y</span><span class="op">)</span>, 
    at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">alpha</span>, <span class="va">beta</span>, <span class="va">gamma</span>, <span class="va">delta</span>, <span class="va">epsilon</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-24-1.png" width="96.3218139399242" style="display: block; margin: auto;"></div>
<p>More complicated texts can be added by using the <strong>gridtext</strong> package (Section <a href="integrate-with-other-packages.html#gridtext-legends">10.3.5</a>).</p>
<div class="sourceCode" id="cb442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, 
    title <span class="op">=</span> <span class="fu">gt_render</span><span class="op">(</span><span class="st">"&lt;span style='color:orange'&gt;**Legend title**&lt;/span&gt;"</span><span class="op">)</span>, 
    title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>box_fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,
    at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, 
    labels <span class="op">=</span> <span class="fu">gt_render</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;span style='color:blue'&gt;*negative*&lt;/span&gt; three"</span>, <span class="st">"zero"</span>, 
                         <span class="st">"&lt;span style='color:red'&gt;*positive*&lt;/span&gt; three"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-26-1.png" width="118.175748031496" style="display: block; margin: auto;"></div>
<p>Settings for horizontal continuous legends are almost the same as vertical
legends, except that now <code>legend_width</code> controls the width of the legend, and
the title position can only be one of <code>topcenter</code>, <code>topleft</code>, <code>lefttop</code> and
<code>leftcenter</code>.</p>
<p>The default style for horizontal legend:</p>
<div class="sourceCode" id="cb443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-28-1.png" width="151.700157480315" style="display: block; margin: auto;"></div>
<p>Manually set <code>at</code>:</p>
<div class="sourceCode" id="cb444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>, 
    direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-30-1.png" width="140.056482939633" style="display: block; margin: auto;"></div>
<p>Manually set <code>labels</code>:</p>
<div class="sourceCode" id="cb445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, 
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"median"</span>, <span class="st">"high"</span><span class="op">)</span>, direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-32-1.png" width="127.649133858268" style="display: block; margin: auto;"></div>
<p>Set <code>legend_width</code>:</p>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, legend_width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">6</span>, <span class="st">"cm"</span><span class="op">)</span>, 
    direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-34-1.png" width="241.889763779528" style="display: block; margin: auto;"></div>
<p>Set graphic parameters for labels:</p>
<div class="sourceCode" id="cb447"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, labels_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span>, font <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, 
    direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-36-1.png" width="151.700157480315" style="display: block; margin: auto;"></div>
<p>Set rotations of labels.</p>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, labels_rot <span class="op">=</span> <span class="fl">45</span>, 
    direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-38-1.png" width="166.260590246026" style="display: block; margin: auto;"></div>
<p>Title can be set as <code>topleft</code>, <code>topcenter</code> or <code>lefttop</code> and <code>leftcenter</code>.</p>
<div class="sourceCode" id="cb449"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foooooooo"</span>, direction <span class="op">=</span> <span class="st">"horizontal"</span>, 
    title_position <span class="op">=</span> <span class="st">"topcenter"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-40-1.png" width="151.700157480315" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foooooooo"</span>, direction <span class="op">=</span> <span class="st">"horizontal"</span>, 
    title_position <span class="op">=</span> <span class="st">"lefttop"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-42-1.png" width="228.605879265092" style="display: block; margin: auto;"></div>
<p>In examples we showed above, the intervals between every two break values are
equal. Actually <code>at</code> can also be set as break values with uneuqal intervals.
In this scenario, the ticks on the legend are still at the original places
while the corresponding texts are shifted to get rid of overlapping. Then,
there are lines connecting the ticks and the labels.</p>
<div class="sourceCode" id="cb451"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-44-1.png" width="71.3009973753281" style="display: block; margin: auto;"></div>
<p>If the labels do not need to be adjusted, they are still at the original places.</p>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.3</span>, <span class="fl">1</span><span class="op">)</span>, 
    legend_height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-46-1.png" width="52.5490813648294" style="display: block; margin: auto;"></div>
<p>It is similar for the horizontal legends:</p>
<div class="sourceCode" id="cb453"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">1</span><span class="op">)</span>,
    direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-48-1.png" width="192.997165354331" style="display: block; margin: auto;"></div>
<p>Set rotations of labels to 90 degree.</p>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">1</span><span class="op">)</span>,
    direction <span class="op">=</span> <span class="st">"horizontal"</span>, title_position <span class="op">=</span> <span class="st">"lefttop"</span>, labels_rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-50-1.png" width="165.716220472441" style="display: block; margin: auto;"></div>
<p>When the position of title is set to <code>lefttop</code>, the area below the title will
also be taken into account when calculating the adjusted positions of labels.</p>
<div class="sourceCode" id="cb455"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mininal"</span>, <span class="st">"q10"</span>, <span class="st">"median"</span>, <span class="st">"q75"</span>, <span class="st">"maximal"</span><span class="op">)</span>,
    direction <span class="op">=</span> <span class="st">"horizontal"</span>, title_position <span class="op">=</span> <span class="st">"lefttop"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-52-1.png" width="262.882204724409" style="display: block; margin: auto;"></div>
<p>If <code>at</code> is set in the decreasing order, the legend is reversed, <em>i.e.</em> the smallest value
is on the top of the legend.</p>
<div class="sourceCode" id="cb456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"foo"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.8</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.2</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-54-1.png" width="52.5490813648294" style="display: block; margin: auto;"></div>
<p>Most continuous legends have legend breaks with equal distance, which I mean,
<em>e.g.</em> the distance between the first and the second breaks are the same as the
distance between the second and the third breaks. However, there are still special
cases where users want to set legend breaks with unequal distances.</p>
<p>In the following example, the color mapping function <code>col_fun_prop</code> visualizes
proportion values with breaks in <code>c(0, 0.05, 0.1, 0.5, 1)</code>. The legend breaks
with unequal distance might reflect the different importance of the values in <code>c(0, 1)</code>.
For example, maybe we want to see more details in the interval <code>c(0, 0.1)</code>.</p>
<p>Following is the default style of the legend where the breaks are selected from 0 to 1
with equal distance.</p>
<div class="sourceCode" id="cb457"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">col_fun_prop</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html">colorRamp2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"white"</span>, <span class="st">"red"</span>, <span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span>
<span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun_prop</span>, title <span class="op">=</span> <span class="st">"Prop"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-56-1.png" width="52.5490813648294" style="display: block; margin: auto;"></div>
<p>You cann’t see the details in the interval <code>c(0, 0.1)</code>, right? This also reminds us that
the breaks set in <code><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html">colorRamp2()</a></code> only defines the color mapping while not determine
the breaks in the legend.</p>
<p>If we manually select the break values, the color bar keeps the same. The labels
are shifted and lines connect them to the original positions. In this case, the distance
in the color bar is still proportional to the real difference in the break values, <em>i.e.</em>,
the distance between 0.5 and 1 is five times longer than 0 and 0.1.</p>
<div class="sourceCode" id="cb458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">col_fun_prop</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html">colorRamp2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"white"</span>, <span class="st">"red"</span>, <span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span>
<span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun_prop</span>, title <span class="op">=</span> <span class="st">"Prop"</span>,
    at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-58-1.png" width="71.3009973753281" style="display: block; margin: auto;"></div>
<p>From version 2.7.1, <code>Legend()</code> function has a new argument <code>break_dist</code> that
controls the distance between two neighbouring break values in the legend.
<strong>It might be confusing, but from here, when I mention “break distance,” it
always means the visual distance in the legend.</strong></p>
<p>The value of <code>break_dist</code> should have length either one which means all break
values have equal distance in the legend, or <code>length(at) - 1</code>.</p>
<div class="sourceCode" id="cb459"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun_prop</span>, title <span class="op">=</span> <span class="st">"Prop"</span>, break_dist <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-60-1.png" width="59.9624146981627" style="display: block; margin: auto;"></div>
<p>And in the following example, the top two break intervals are three times longer than
the bottom two intervals.</p>
<div class="sourceCode" id="cb460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun_prop</span>, title <span class="op">=</span> <span class="st">"Prop"</span>, break_dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-62-1.png" width="71.3009973753281" style="display: block; margin: auto;"></div>
<p>If we increase the legend height by <code>legend_height</code> argument, there will be enough space
for the labels and their positions are not adjusted any more.</p>
<div class="sourceCode" id="cb461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun_prop</span>, title <span class="op">=</span> <span class="st">"Prop"</span>, break_dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,
    legend_height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-64-1.png" width="59.9624146981627" style="display: block; margin: auto;"></div>
<p>Imaging following user case, we want to use one color scheme for the values in
<code>c(0, 0.1)</code> and a second color schema for the values in <code>c(0.1, 1)</code>, maybe for
the reason that we want to emphasize the two intervals are very different. The
color mapping can be defined as:</p>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">col_fun2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html">colorRamp2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">+</span><span class="fl">1e-6</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"red"</span>, <span class="st">"yellow"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>So here I just added a tiny shift (<code>1e-6</code>) to 0.1 and set it as the lower bound for the
second color scheme. The legend looks like:</p>
<div class="sourceCode" id="cb463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun2</span>, title <span class="op">=</span> <span class="st">"Prop"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,
    break_dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, legend_height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-67-1.png" width="59.9624146981627" style="display: block; margin: auto;"></div>
<p>Now you can see the colors are not changed smoothly from 0 to 1 and there are two disticnt
color schemes.</p>
</div>
<div id="discrete-legends" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Discrete legends<a class="anchor" aria-label="anchor" href="#discrete-legends"><i class="fas fa-link"></i></a>
</h2>
<p>Discrete legends are used for discrete color mappings. The continuous color
mapping can also be degenerated as discrete color mapping by only providing
the colors and the break values.</p>
<p>You can either specify <code>at</code> or <code>labels</code>, but most probably you specify
<code>labels</code>. The colors should be specified by <code>legend_gp</code>.</p>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, title <span class="op">=</span> <span class="st">"foo"</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-69-1.png" width="41.4290813648294" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, title <span class="op">=</span> <span class="st">"foo"</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-71-1.png" width="87.5624146981627" style="display: block; margin: auto;"></div>
<p>The discrete legend for continuous color mapping:</p>
<div class="sourceCode" id="cb466"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">at</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>at <span class="op">=</span> <span class="va">at</span>, title <span class="op">=</span> <span class="st">"foo"</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">col_fun</span><span class="op">(</span><span class="va">at</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-73-1.png" width="52.5490813648294" style="display: block; margin: auto;"></div>
<p>The position of title:</p>
<div class="sourceCode" id="cb467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, title <span class="op">=</span> <span class="st">"foo"</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>,
    title_position <span class="op">=</span> <span class="st">"lefttop"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-75-1.png" width="115.58813648294" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb468"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, title <span class="op">=</span> <span class="st">"foo"</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>,
    title_position <span class="op">=</span> <span class="st">"leftcenter-rot"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-77-1.png" width="104.694803149606" style="display: block; margin: auto;"></div>
<p>The size of grids are controlled by <code>grid_width</code> and <code>grid_height</code>.</p>
<div class="sourceCode" id="cb469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"foo"</span>, 
    grid_height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span>, grid_width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">5</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-79-1.png" width="45.2086089238845" style="display: block; margin: auto;"></div>
<p>The graphic parameters of labels are controlled by <code>labels_gp</code>.</p>
<div class="sourceCode" id="cb470"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"foo"</span>, 
    labels_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span>, fontsize <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-81-1.png" width="108.981081364829" style="display: block; margin: auto;"></div>
<p>The graphic parameters of the title are controlled by <code>title_gp</code>.</p>
<div class="sourceCode" id="cb471"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"foo"</span>, 
    title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span>, fontsize <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-83-1.png" width="87.5624146981627" style="display: block; margin: auto;"></div>
<p>Title and labels are be complicated texts by integrating <strong>gridtext</strong> package (Section <a href="integrate-with-other-packages.html#gridtext-legends">10.3.5</a>):</p>
<div class="sourceCode" id="cb472"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>
    title <span class="op">=</span> <span class="fu">gt_render</span><span class="op">(</span><span class="st">"&lt;span style='color:orange'&gt;**Legend title**&lt;/span&gt;"</span><span class="op">)</span>, 
    title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>box_fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,
    at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, 
    labels <span class="op">=</span> <span class="fu">gt_render</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"**negative** three"</span>, <span class="st">"*zero*"</span>, <span class="st">"**positive** three"</span><span class="op">)</span><span class="op">)</span>,
    legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-85-1.png" width="138.922414698163" style="display: block; margin: auto;"></div>
<p>Borders of grids are controlled by <code>border</code>.</p>
<div class="sourceCode" id="cb473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"foo"</span>, 
    border <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-87-1.png" width="87.5624146981627" style="display: block; margin: auto;"></div>
<p>One important thing for the discrete legend is you can arrange the grids into
multiple rows or/and columns. If <code>ncol</code> is set to a number, the grids are
arranged into <code>ncol</code> columns.</p>
<div class="sourceCode" id="cb474"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, 
    title <span class="op">=</span> <span class="st">"foo"</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-89-1.png" width="246.795800524934" style="display: block; margin: auto;"></div>
<p>Still the title position is calculated based on the multiplt-column legend.</p>
<div class="sourceCode" id="cb475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"foo"</span>, 
    ncol <span class="op">=</span> <span class="fl">3</span>, title_position <span class="op">=</span> <span class="st">"topcenter"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-91-1.png" width="246.795800524934" style="display: block; margin: auto;"></div>
<p>You can choose to list the legend levels by rows by setting <code>by_row = TRUE</code>.</p>
<div class="sourceCode" id="cb476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"foo"</span>, 
    ncol <span class="op">=</span> <span class="fl">3</span>, by_row <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-93-1.png" width="253.115800524934" style="display: block; margin: auto;"></div>
<p>The gaps between two columns are controlled by <code>gap</code> or <code>column_gap</code>. These two arguments
are treated the same.</p>
<div class="sourceCode" id="cb477"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"foo"</span>, 
    ncol <span class="op">=</span> <span class="fl">3</span>, gap <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-95-1.png" width="307.268241469816" style="display: block; margin: auto;"></div>
<p>The gaps between rows are controlled by <code>row_gap</code>.</p>
<div class="sourceCode" id="cb478"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"foo"</span>, 
    ncol <span class="op">=</span> <span class="fl">3</span>, row_gap <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">5</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-97-1.png" width="246.795800524934" style="display: block; margin: auto;"></div>
<p>Instead of <code>ncol</code>, you can also specify the layout by <code>nrow</code>. Note you cannot
use <code>ncol</code> and <code>nrow</code> at a same time.</p>
<div class="sourceCode" id="cb479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, 
    title <span class="op">=</span> <span class="st">"foo"</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-99-1.png" width="308.21249343832" style="display: block; margin: auto;"></div>
<p>One extreme case is when all levels are put in one row and the title are
rotated by 90 degree. The height of the legend will be the height of the
rotated title.</p>
<div class="sourceCode" id="cb480"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"foooooo"</span>, 
    nrow <span class="op">=</span> <span class="fl">1</span>, title_position <span class="op">=</span> <span class="st">"lefttop-rot"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-101-1.png" width="401.738267716535" style="display: block; margin: auto;"></div>
<p>Following style a lot of people might like:</p>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"foooooo"</span>, 
    nrow <span class="op">=</span> <span class="fl">1</span>, title_position <span class="op">=</span> <span class="st">"leftcenter"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-103-1.png" width="445.218267716535" style="display: block; margin: auto;"></div>
<p><code>Legend()</code> also supports to use simple graphics (e.g. points, lines, boxplots) as
legends. <code>type</code> argument can be specified as <code>points</code> or <code>p</code> that you can use number
for <code>pch</code> or single-letter for <code>pch</code>.</p>
<div class="sourceCode" id="cb482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, title <span class="op">=</span> <span class="st">"foo"</span>, type <span class="op">=</span> <span class="st">"points"</span>, 
    pch <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, background <span class="op">=</span> <span class="st">"#FF8080"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-105-1.png" width="87.5624146981627" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, title <span class="op">=</span> <span class="st">"foo"</span>, type <span class="op">=</span> <span class="st">"points"</span>, 
    pch <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, background <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-107-1.png" width="87.5624146981627" style="display: block; margin: auto;"></div>
<p>Or set <code>type = "lines"</code>/<code>type = "l"</code> to use lines as legend:</p>
<div class="sourceCode" id="cb484"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, title <span class="op">=</span> <span class="st">"foo"</span>, type <span class="op">=</span> <span class="st">"lines"</span>, 
    legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, grid_width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-109-1.png" width="110.239580052493" style="display: block; margin: auto;"></div>
<p>Or set <code>type = "boxplot"</code>/<code>type = "box"</code> to use boxes as legends:</p>
<div class="sourceCode" id="cb485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, title <span class="op">=</span> <span class="st">"foo"</span>, type <span class="op">=</span> <span class="st">"boxplot"</span>,
    legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-111-1.png" width="87.5624146981627" style="display: block; margin: auto;"></div>
<p>When <code>pch</code> is an integer number, the numbers in <code>26:28</code> correspond to following symbols:</p>
<div class="sourceCode" id="cb486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"pch = "</span>, <span class="fl">26</span><span class="op">:</span><span class="fl">28</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"points"</span>, pch <span class="op">=</span> <span class="fl">26</span><span class="op">:</span><span class="fl">28</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-113-1.png" width="85.5357480314961" style="display: block; margin: auto;"></div>
<p>In all examples showed above, the labels are single lines. Multiple-line labels are also
supported. As shown in the following example, legend grids for multiple-line labels are
automatically enlongated.</p>
<div class="sourceCode" id="cb487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"aaaaa\naaaaa"</span>, <span class="st">"bbbbb\nbbbbb"</span>, <span class="st">"c"</span>, <span class="st">"d"</span><span class="op">)</span>,
    legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-115-1.png" width="71.0824146981627" style="display: block; margin: auto;"></div>
<p>If the legend is arranged in multiple rows or columns, the sizes of legend grids are adjusted
to the label with the most number of lines.</p>
<div class="sourceCode" id="cb488"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"aaaaa\naaaaa"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"bbbbb\nbbbbb"</span><span class="op">)</span>,
    legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-117-1.png" width="134.072440944882" style="display: block; margin: auto;"></div>
<p>The last useful argument <code>graphics</code> can be used to self-define the legend
graphics. The value for <code>graphics</code> should be a list of functions with four
arguments: <code>x</code> and <code>y</code>: the center of the legend grid, <code>w</code> and <code>h</code>: the width
and height of the legend grid. Length of <code>graphics</code> should be the same as <code>at</code>
or <code>labels.</code> If <code>graphics</code> is a named list where the names correspond to
<code>labels</code>, then the order of the list of <code>graphics</code> is automatically adjusted.</p>
<div class="sourceCode" id="cb489"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>,
    graphics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">w</span>, <span class="va">h</span><span class="op">)</span> <span class="fu">grid.rect</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">w</span><span class="op">*</span><span class="fl">0.33</span>, <span class="va">h</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span>,
        <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">w</span>, <span class="va">h</span><span class="op">)</span> <span class="fu">grid.rect</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">w</span>, <span class="va">h</span><span class="op">*</span><span class="fl">0.33</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span>,
        <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">w</span>, <span class="va">h</span><span class="op">)</span> <span class="fu">grid.text</span><span class="op">(</span><span class="st">"A"</span>, <span class="va">x</span>, <span class="va">y</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span>,
        <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">w</span>, <span class="va">h</span><span class="op">)</span> <span class="fu">grid.points</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>
    <span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-119-1.png" width="41.4290813648294" style="display: block; margin: auto;"></div>
</div>
<div id="a-list-of-legends" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> A list of legends<a class="anchor" aria-label="anchor" href="#a-list-of-legends"><i class="fas fa-link"></i></a>
</h2>
<p>A list of legends can be constructed or packed as a <code>Legends</code> object where the
individual legends are arranged within a certain layout. The legend list can
be sent to <code>packLegend()</code> separatedly or as a list. The legend can be arranged
either vertically or horizontally. <strong>ComplexHeatmap</strong> uses <code>packLegend()</code>
internally to arrange multiple legends. Normally you don’t need to manually
control the arrangement of multiple legends, but the following section would
be useful if you want to manually construct a list of legends and apply to
other plots.</p>
<div class="sourceCode" id="cb490"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd1</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"legend1"</span><span class="op">)</span>
<span class="va">lgd2</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"legend2"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">lgd3</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"legend3"</span><span class="op">)</span>

<span class="va">pd</span> <span class="op">=</span> <span class="fu">packLegend</span><span class="op">(</span><span class="va">lgd1</span>, <span class="va">lgd2</span>, <span class="va">lgd3</span><span class="op">)</span>
<span class="co"># which is same as </span>
<span class="va">pd</span> <span class="op">=</span> <span class="fu">packLegend</span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">lgd1</span>, <span class="va">lgd2</span>, <span class="va">lgd3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-121-1.png" width="87.5624146981628" style="display: block; margin: auto;"></div>
<p>Simillar as single legend, you can draw the packed legends by <code>draw()</code>
function. Also you can get the size of <code>pd</code> by <code>ComplexHeatmap:::width()</code> and
<code>ComplexHeatmap:::height()</code>.</p>
<div class="sourceCode" id="cb491"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ComplexHeatmap</span><span class="fu">:::</span><span class="fu">width</span><span class="op">(</span><span class="va">pd</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 19.1675555555556mm</code></pre>
<div class="sourceCode" id="cb493"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ComplexHeatmap</span><span class="fu">:::</span><span class="fu">height</span><span class="op">(</span><span class="va">pd</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 78.6988333333334mm</code></pre>
<p>Horizontally arranging the legends simply by setting <code>direction = "horizontal"</code>.</p>
<div class="sourceCode" id="cb495"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pd</span> <span class="op">=</span> <span class="fu">packLegend</span><span class="op">(</span><span class="va">lgd1</span>, <span class="va">lgd2</span>, <span class="va">lgd3</span>, direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-124-1.png" width="218.838635170604" style="display: block; margin: auto;"></div>
<p>One feature of <code>packLegend()</code> is, e.g. if the packing is vertically and the
sum of the packed legends exceeds the height specified by <code>max_height</code>, it
will be rearragned as mutliple column layout. In following example, the
maximum height is <code>10cm</code>.</p>
<p>When all the legends are put into multiple columns, <code>column_gap</code> controls the
space between two columns.</p>
<div class="sourceCode" id="cb496"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pd</span> <span class="op">=</span> <span class="fu">packLegend</span><span class="op">(</span><span class="va">lgd1</span>, <span class="va">lgd3</span>, <span class="va">lgd2</span>, <span class="va">lgd3</span>, <span class="va">lgd2</span>, <span class="va">lgd1</span>, max_height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">10</span>, <span class="st">"cm"</span><span class="op">)</span>, 
    column_gap <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-126-1.png" width="286.117270341207" style="display: block; margin: auto;"></div>
<p>Similar for horizontal packing:</p>
<div class="sourceCode" id="cb497"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd1</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"legend1"</span>,
    nr <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">lgd2</span> <span class="op">=</span> <span class="fu">Legend</span><span class="op">(</span>col_fun <span class="op">=</span> <span class="va">col_fun</span>, title <span class="op">=</span> <span class="st">"legend2"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,
    direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span>

<span class="va">pd</span> <span class="op">=</span> <span class="fu">packLegend</span><span class="op">(</span><span class="va">lgd1</span>, <span class="va">lgd2</span>, <span class="va">lgd3</span>, <span class="va">lgd1</span>, <span class="va">lgd2</span>, <span class="va">lgd3</span>, max_width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">10</span>, <span class="st">"cm"</span><span class="op">)</span>, 
    direction <span class="op">=</span> <span class="st">"horizontal"</span>, column_gap <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">5</span>, <span class="st">"mm"</span><span class="op">)</span>, row_gap <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-128-1.png" width="354.615223097113" style="display: block; margin: auto;"></div>
<p>The packed legends <code>pd</code> is also a <code>Legends</code> object, which means you can use
<code>draw()</code> to draw it by specifying the positions.</p>
<div class="sourceCode" id="cb498"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pd</span> <span class="op">=</span> <span class="fu">packLegend</span><span class="op">(</span><span class="va">lgd1</span>, <span class="va">lgd2</span>, <span class="va">lgd3</span>, direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span>
<span class="fu">pushViewport</span><span class="op">(</span><span class="fu">viewport</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.8</span>, height <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>
<span class="fu">grid.rect</span><span class="op">(</span><span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">pd</span>, x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span>, just <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">pd</span>, x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span>, just <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"top"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">popViewport</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-129-1.png" width="672" style="display: block; margin: auto;"></div>
<p>To be mentioned again, <code>packLegend()</code> is used internally to manage the list
of heatmap and annotation legends.</p>
</div>
<div id="heatmap-and-annotation-legends" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Heatmap and annotation legends<a class="anchor" aria-label="anchor" href="#heatmap-and-annotation-legends"><i class="fas fa-link"></i></a>
</h2>
<p>Settings for heatmap legend are controlled by <code>heatmap_legend_param</code> argument
in <code>Heatmap()</code>. The value for <code>heatmap_legend_param</code> is a list of parameters
which are supported in <code>Legend()</code>.</p>
<div class="sourceCode" id="cb499"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat"</span>, heatmap_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"zero"</span>, <span class="st">"high"</span><span class="op">)</span>,
    title <span class="op">=</span> <span class="st">"Some values"</span>,
    legend_height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">4</span>, <span class="st">"cm"</span><span class="op">)</span>,
    title_position <span class="op">=</span> <span class="st">"lefttop-rot"</span>
<span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-130-1.png" width="499.2" style="display: block; margin: auto;"></div>
<p><code>annotation_legend_param</code> controls legends for annotations. Since a
<code>HeatmapAnnotation</code> may contain multiple annotations, the value of
<code>annotation_legend_param</code> is a list of configurations of each annotation.</p>
<div class="sourceCode" id="cb500"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ha</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>foo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, bar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    annotation_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        foo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                title <span class="op">=</span> <span class="st">"Fooooooh"</span>,
                at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,
                labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"zero"</span>, <span class="st">"median"</span>, <span class="st">"one"</span><span class="op">)</span>
            <span class="op">)</span>,
        bar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                title <span class="op">=</span> <span class="st">"Baaaaaaar"</span>,
                at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>,
                labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Female"</span>, <span class="st">"Male"</span><span class="op">)</span>
            <span class="op">)</span>
<span class="op">)</span><span class="op">)</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat"</span>, top_annotation <span class="op">=</span> <span class="va">ha</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-131-1.png" width="499.2" style="display: block; margin: auto;"></div>
<p>If the heatmaps are concatenated horizontally, all heatmap and row annotation
legends are grouped and all column annotation legends ae grouped. The reason
we assume the horizontal direction passes the main message of the plot, while
the vertical direction provides secondary information.</p>
<div class="sourceCode" id="cb501"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ha1</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>foo1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, bar1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">ha2</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>foo2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, bar2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat1"</span>, top_annotation <span class="op">=</span> <span class="va">ha1</span><span class="op">)</span> <span class="op">+</span>
<span class="fu">rowAnnotation</span><span class="op">(</span>sth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat2"</span>, top_annotation <span class="op">=</span> <span class="va">ha2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-132-1.png" width="768" style="display: block; margin: auto;"></div>
<p>Similarlly, if the heatmaps are concatenated vertically, all heatmaps/column
annotations are grouped and legends for all row annotations are grouped.</p>
<div class="sourceCode" id="cb502"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ha1</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>foo1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, bar1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, 
    annotation_name_side <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span>
<span class="va">ha2</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>foo2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, bar2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat1"</span>, top_annotation <span class="op">=</span> <span class="va">ha1</span><span class="op">)</span> <span class="op">%v%</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat2"</span>, top_annotation <span class="op">=</span> <span class="va">ha2</span>, 
    right_annotation <span class="op">=</span> <span class="fu">rowAnnotation</span><span class="op">(</span>sth <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-133-1.png" width="499.2" style="display: block; margin: auto;"></div>
<p><code>show_legend</code> in <code>HeatmapAnnotation()</code> and <code>show_heatmap_legend</code> in
<code>Heatmap()</code> controls whether show the legends. Note <code>show_legend</code> can be a
single logical value, a logical vector, or a named vector which controls
subset of annotations.</p>
<div class="sourceCode" id="cb503"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ha</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>foo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, 
    bar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    show_legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="co"># it can also be show_legend = c(bar = FALSE)</span>
    annotation_name_side <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat1"</span>, top_annotation <span class="op">=</span> <span class="va">ha</span><span class="op">)</span> <span class="op">+</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat2"</span>, show_heatmap_legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-134-1.png" width="768" style="display: block; margin: auto;"></div>
<p><code>merge_legend</code> in <code>draw()</code> function controlls whether to merge all the legends
into a single group. Normally, when there are many annotations and heatmaps,
the number of legends is always large. In this case, the legends are
automatically arranged into multiple columns (or multiple rows if they are put
at the bottom of the heatmaps) to get rid of being out of the figure page. If
a heatmap has heatmap annotations, the order of putting legends are: legends
for the left annotations, legends for the top annotations, legend of the
heatmap, legends for the bottom annotations and legends for the right
annotations.</p>
<div class="sourceCode" id="cb504"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ha1</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>foo1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, 
    bar1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">ha2</span> <span class="op">=</span> <span class="fu">rowAnnotation</span><span class="op">(</span>foo2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, 
    bar2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">ha3</span> <span class="op">=</span> <span class="fu">rowAnnotation</span><span class="op">(</span>foo3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, 
    bar3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">month.name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">ht_list</span> <span class="op">=</span> <span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat1"</span>, top_annotation <span class="op">=</span> <span class="va">ha1</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat2"</span>, left_annotation <span class="op">=</span> <span class="va">ha2</span><span class="op">)</span> <span class="op">+</span> 
    <span class="va">ha3</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">ht_list</span>, merge_legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-135-1.png" width="768" style="display: block; margin: auto;"></div>
<p>If you want the heatmap legends to be the “pure heatmap legends,” you can set
<code>legend_grouping = "original"</code> to enforce all annotation legends to be put together,
no matter whether they are row annotation legends or column annotation legends.</p>
<div class="sourceCode" id="cb505"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">draw</span><span class="op">(</span><span class="va">ht_list</span>, legend_grouping <span class="op">=</span> <span class="st">"original"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-136-1.png" width="672" style="display: block; margin: auto;"></div>
<p>A continuous color mapping can have a
discrete legend by setting <code>color_bar = "discrete"</code>, both work for heatmap
legends and annotation legends.</p>
<div class="sourceCode" id="cb506"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat"</span>, heatmap_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color_bar <span class="op">=</span> <span class="st">"discrete"</span><span class="op">)</span>,
    top_annotation <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>foo <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,
        annotation_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
            foo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color_bar <span class="op">=</span> <span class="st">"discrete"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-137-1.png" width="499.2" style="display: block; margin: auto;"></div>
<p>If the <code>value</code> is a character vector, no matter it is an annotation or the one-row/one-column
matrix for the heatmap, the default order of legend labels is <code>sort(unique(value))</code> and if <code>value</code>
is a factor, the order of legend labels is <code>levels(value)</code>. Always remember the order can be
fine-tuned by setting <code>at</code> and <code>labels</code> parameters in <code>heatmap_legend_param</code>/<code>annotation_legend_param</code>
in <code>Heatmap()</code>/<code>HeamtapAnnotation()</code> functions respectively.</p>
<div class="sourceCode" id="cb507"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">chr</span></code></pre></div>
<pre><code>##  [1] "a" "c" "b" "c" "b" "a" "a" "a" "b" "c"</code></pre>
<div class="sourceCode" id="cb509"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fa1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">chr</span><span class="op">)</span>
<span class="va">fa2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">chr</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, top_annotation <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>chr <span class="op">=</span> <span class="va">chr</span>, fa1 <span class="op">=</span> <span class="va">fa1</span>, fa2 <span class="op">=</span> <span class="va">fa2</span>, fa3 <span class="op">=</span> <span class="va">fa2</span>,
    annotation_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fa3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-138-1.png" width="499.2" style="display: block; margin: auto;"></div>
</div>
<div id="add-customized-legends" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Add customized legends<a class="anchor" aria-label="anchor" href="#add-customized-legends"><i class="fas fa-link"></i></a>
</h2>
<p>The self-defined legends (constructed by <code>Legend()</code>) can be added to the
heatmap legend list by <code>heatmap_legend_list</code> argument in <code>draw()</code> and the
legends for annotations can be added to the annotation legend list by
<code>annotation_legend_list</code> argument.</p>
<p>There is a nice example of adding self-defined legends in Section
<a href="other-high-level-plots.html#stacked-summary-plot">11.2</a>, but here we show a simple example.</p>
<p>As mentioned before, only the heatmap and simple annotations can generate
legends on the plot. <strong>ComplexHeatmap</strong> provides many annotation functions,
but none of them supports generating legends. In following code, we add a
point annotation, a line annotation and a summary annotation to the heatmaps.</p>
<div class="sourceCode" id="cb510"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ha1</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>pt <span class="op">=</span> <span class="fu">anno_points</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, each <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>, 
    height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, show_annotation_name <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">ha2</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>ln <span class="op">=</span> <span class="fu">anno_lines</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,
    height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, show_annotation_name <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
<span class="va">ht_list</span> <span class="op">=</span> <span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat1"</span>, top_annotation <span class="op">=</span> <span class="va">ha1</span><span class="op">)</span> <span class="op">+</span> 
          <span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat2"</span>, top_annotation <span class="op">=</span> <span class="va">ha2</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, name <span class="op">=</span> <span class="st">"mat3"</span>, 
            top_annotation <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>
                summary <span class="op">=</span> <span class="fu">anno_summary</span><span class="op">(</span>gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>
          <span class="op">)</span>, width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">ht_list</span>, ht_gap <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">7</span>, <span class="st">"mm"</span><span class="op">)</span>, row_km <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-139-1.png" width="576" style="display: block; margin: auto;"></div>
<p>Next we construct legends for the points, the lines and the boxplots.</p>
<div class="sourceCode" id="cb511"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lgd_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"pt"</span>, type <span class="op">=</span> <span class="st">"points"</span>, pch <span class="op">=</span> <span class="fl">16</span>, 
        legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkblue"</span>, <span class="st">"lightblue"</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"ln"</span>, type <span class="op">=</span> <span class="st">"lines"</span>, 
        legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu">Legend</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"km"</span>, type <span class="op">=</span> <span class="st">"boxplot"</span>,
        legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">ht_list</span>, ht_gap <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">7</span>, <span class="st">"mm"</span><span class="op">)</span>, row_km <span class="op">=</span> <span class="fl">2</span>, annotation_legend_list <span class="op">=</span> <span class="va">lgd_list</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-140-1.png" width="576" style="display: block; margin: auto;"></div>
</div>
<div id="the-side-of-legends" class="section level2" number="5.6">
<h2>
<span class="header-section-number">5.6</span> The side of legends<a class="anchor" aria-label="anchor" href="#the-side-of-legends"><i class="fas fa-link"></i></a>
</h2>
<p>By default, the heatmap legends and annotation legends are put on the right of
the plot. The side relative to the heatmaps of the two types of legends can be
controlled by <code>heatmap_legend_side</code> and <code>annotation_legend_side</code> arguments in
<code>draw()</code> function. The values that can be set for the two arguments are
<code>left</code>, <code>right</code>, <code>bottom</code> and <code>top</code>.</p>
<div class="sourceCode" id="cb512"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
<span class="va">ha1</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>foo1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, bar1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">ha2</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>foo2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, bar2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">ht_list</span> <span class="op">=</span> <span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat1"</span>, top_annotation <span class="op">=</span> <span class="va">ha1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">rowAnnotation</span><span class="op">(</span>sth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat2"</span>, top_annotation <span class="op">=</span> <span class="va">ha2</span><span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">ht_list</span>, heatmap_legend_side <span class="op">=</span> <span class="st">"left"</span>, annotation_legend_side <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-141-1.png" width="768" style="display: block; margin: auto;"></div>
<p>When the legends are put at the bottom or on the top, the legends are arranged
horizontally. We might also want to set every single legend as horizontal
legend, this needs to be set via the <code>heatmap_legend_param</code> and
<code>annotation_legend_param</code> arguments in <code>Heatmap()</code> and <code>HeatmapAnnotation()</code>
functions:</p>
<div class="sourceCode" id="cb513"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ha1</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>foo1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, bar1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    annotation_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        foo1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span>,
        bar1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ha2</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>foo2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, bar2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    annotation_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        foo2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span>,
        bar2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ht_list</span> <span class="op">=</span> <span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat1"</span>, top_annotation <span class="op">=</span> <span class="va">ha1</span>, 
        heatmap_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">rowAnnotation</span><span class="op">(</span>sth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, 
        annotation_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">Heatmap</span><span class="op">(</span><span class="va">m</span>, name <span class="op">=</span> <span class="st">"mat2"</span>, top_annotation <span class="op">=</span> <span class="va">ha2</span>,
        heatmap_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">ht_list</span>, merge_legend <span class="op">=</span> <span class="cn">TRUE</span>, heatmap_legend_side <span class="op">=</span> <span class="st">"bottom"</span>, 
    annotation_legend_side <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-legends_files/figure-html/unnamed-chunk-142-1.png" width="768" style="display: block; margin: auto;"></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="a-list-of-heatmaps.html"><span class="header-section-number">4</span> A List of Heatmaps</a></div>
<div class="next"><a href="heatmap-decoration.html"><span class="header-section-number">6</span> Heatmap Decoration</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#legends"><span class="header-section-number">5</span> Legends</a></li>
<li><a class="nav-link" href="#continuous-legends"><span class="header-section-number">5.1</span> Continuous legends</a></li>
<li><a class="nav-link" href="#discrete-legends"><span class="header-section-number">5.2</span> Discrete legends</a></li>
<li><a class="nav-link" href="#a-list-of-legends"><span class="header-section-number">5.3</span> A list of legends</a></li>
<li><a class="nav-link" href="#heatmap-and-annotation-legends"><span class="header-section-number">5.4</span> Heatmap and annotation legends</a></li>
<li><a class="nav-link" href="#add-customized-legends"><span class="header-section-number">5.5</span> Add customized legends</a></li>
<li><a class="nav-link" href="#the-side-of-legends"><span class="header-section-number">5.6</span> The side of legends</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jokergoo/ComplexHeatmap/blob/master/05-legends.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jokergoo/ComplexHeatmap/edit/master/05-legends.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>ComplexHeatmap Complete Reference</strong>" was written by Zuguang Gu. It was last built on last revised on 2022-07-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
